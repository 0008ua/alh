(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{zWcS:function(t,e,a){"use strict";a.r(e),a.d(e,"SummaryPageModule",function(){return j});var o=a("ofXK"),i=a("3Pt+"),n=a("TEn/"),s=a("tyNb"),c=a("IjAw"),l=a("OuL/"),r=a("gXqy"),b=a("zHMj"),d=a("EhJz"),m=a("dndX"),u=a("tJKL"),h=a("4dfA"),y=a("mgGq"),g=a("itXk"),D=a("LRne"),p=a("5+tZ"),M=a("zP0r"),v=a("fXoL"),S=a("mrZj"),f=a("l7P3");function N(t,e){if(1&t&&(v.Nb(0,"ion-item",3),v.Nb(1,"ion-label"),v.Nb(2,"p"),v.mc(3),v.Mb(),v.Mb(),v.Nb(4,"ion-text",7),v.mc(5),v.Mb(),v.Mb()),2&t){const t=e.$implicit;v.yb(3),v.nc(t.name),v.yb(2),v.nc(t.analytics.totalSold)}}function O(t,e){if(1&t&&(v.Lb(0),v.lc(1,N,6,2,"ion-item",13),v.Yb(2,"slice"),v.Kb()),2&t){const t=v.Xb();v.yb(1),v.dc("ngForOf",v.ac(2,1,t.calculatedData.rooms,1))}}function I(t,e){if(1&t&&(v.Nb(0,"ion-item",3),v.Nb(1,"ion-label"),v.Nb(2,"p"),v.mc(3),v.Mb(),v.Mb(),v.Nb(4,"ion-text",7),v.mc(5),v.Mb(),v.Mb()),2&t){const t=e.$implicit;v.yb(3),v.nc(t.name),v.yb(2),v.nc(t.analytics.totalPayments)}}function L(t,e){if(1&t&&(v.Lb(0),v.lc(1,I,6,2,"ion-item",13),v.Yb(2,"slice"),v.Kb()),2&t){const t=v.Xb();v.yb(1),v.dc("ngForOf",v.ac(2,1,t.calculatedData.rooms,1))}}function R(t,e){if(1&t&&(v.Nb(0,"ion-item",3),v.Nb(1,"ion-label"),v.Nb(2,"p"),v.mc(3),v.Mb(),v.Jb(4,"ion-progress-bar",12),v.Mb(),v.Nb(5,"ion-text",7),v.mc(6),v.Yb(7,"percent"),v.Mb(),v.Mb()),2&t){const t=e.$implicit;v.yb(3),v.nc(t.name),v.yb(1),v.dc("value",t.analytics.totalRoomDays/t.analytics.daysInMonth),v.yb(2),v.oc("",v.ac(7,3,t.analytics.totalRoomDays/t.analytics.daysInMonth,"2.0-0")," ")}}function T(t,e){if(1&t&&(v.Lb(0),v.lc(1,R,8,6,"ion-item",13),v.Yb(2,"slice"),v.Kb()),2&t){const t=v.Xb();v.yb(1),v.dc("ngForOf",v.ac(2,1,t.calculatedData.rooms,1))}}const w=[{path:"",component:(()=>{class t{constructor(t,e,a){this.sheduleService=t,this.store=e,this.route=a,this.date=this.sheduleService.convertDateToShort(new Date),this.maxDate=this.sheduleService.convertDateToShort(c.a(new Date,{years:1})),this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.date)),this.calculatedData={rooms:[]}}ngOnChanges(){console.log("asdasd")}ngOnInit(){const t=this.store.select(y.a),e=this.store.select(u.a),a=this.store.select(u.b);t.pipe(Object(p.a)(t=>(console.log("company summary",t),t?(console.log("combineLatest"),this.rooms=[...t.rooms],this.rooms.unshift({_id:null,name:"All"}),this.room=this.rooms[0],Object(g.a)([e,a])):Object(D.a)([null,null]))),Object(M.a)(1)).subscribe(([t,e])=>{t&&e&&(console.log("bookings summary",t),console.log("payments summary",e),this.bookings=t,this.payments=e,this.calcData())},t=>console.log("load data err",t)),this.route.url.subscribe(t=>{console.log("url"),this.filter()})}calcData(){console.log("calc"),this.calculatedData.rooms=[];let t=0,e=0,a=0;const o=l.a(this.sheduleService.convertISOToDate(this.date))-1;this.rooms.forEach(i=>{if(!i._id)return void this.calculatedData.rooms.push(i);this.calculatedData.rooms.push(i);const n=this.calculatedData.rooms.length-1;let s=0,c=0,l=0;this.payments.forEach(t=>{i._id!==t.room_id&&(l+=t.amount)}),this.bookings.forEach(t=>{if(i._id===t.room_id)return;const e=r.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(t.dates.from)),a=(t.price-t.discount)/e;let o,n,l=0;b.a(this.sheduleService.convertISOToDate(t.dates.from),this.sheduleService.convertISOToDate(this.dateRangeLimits.upper))?l=1:b.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(this.dateRangeLimits.lower))?l=0:(o=d.a(this.sheduleService.convertISOToDate(t.dates.from),this.sheduleService.convertISOToDate(this.dateRangeLimits.lower))||b.a(this.sheduleService.convertISOToDate(t.dates.from),this.sheduleService.convertISOToDate(this.dateRangeLimits.lower))?t.dates.from:this.dateRangeLimits.lower,n=m.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(this.dateRangeLimits.upper))||b.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(this.dateRangeLimits.upper))?t.dates.to:this.dateRangeLimits.upper,l=r.a(this.sheduleService.convertISOToDate(n),this.sheduleService.convertISOToDate(o)),s+=l*a,c+=l)}),this.calculatedData.rooms[n]=Object.assign(Object.assign({},this.calculatedData.rooms[n]),{analytics:{totalSold:s,totalRoomDays:c,daysInMonth:o,totalPayments:l}}),t+=s,e+=c,a+=l}),this.calculatedData.rooms[0]=Object.assign(Object.assign({},this.calculatedData.rooms[0]),{analytics:{totalSold:t,totalRoomDays:e/this.calculatedData.rooms.length,daysInMonth:o,totalPayments:a}}),console.log("this.calculatedData.rooms",this.calculatedData.rooms)}filter(){const t=this.createBookingQuery(),e=this.createPaymentQuery();this.store.dispatch(new h.a(t)),this.store.dispatch(new h.c(e))}createBookingQuery(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.date)),{dateRangeLimits:this.dateRangeLimits,bookingStep:{val:"cancelled",expr:"$ne"}}}createPaymentQuery(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.date)),{dateRangeLimits:this.dateRangeLimits}}}return t.\u0275fac=function(e){return new(e||t)(v.Ib(S.a),v.Ib(f.i),v.Ib(s.a))},t.\u0275cmp=v.Cb({type:t,selectors:[["app-summary"]],features:[v.wb],decls:50,vars:12,consts:[["slot","end"],["menu","analytics-menu"],["size-md","6","offset-md","3"],["lines","none"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","ngModelChange","ionChange"],["slot","start","color","primary","checked",""],["totalSold",""],["slot","end","color","primary"],[4,"ngIf"],["slot","start","color","primary"],["totalPaid",""],["occupancy",""],["color","primary",3,"value"],["lines","none",4,"ngFor","ngForOf"]],template:function(t,e){if(1&t&&(v.Nb(0,"ion-header"),v.Nb(1,"ion-toolbar"),v.Nb(2,"ion-title"),v.mc(3,"Summary"),v.Mb(),v.Nb(4,"ion-buttons",0),v.Jb(5,"ion-menu-button",1),v.Mb(),v.Mb(),v.Nb(6,"ion-toolbar"),v.Nb(7,"ion-grid"),v.Nb(8,"ion-row"),v.Nb(9,"ion-col",2),v.Nb(10,"ion-item",3),v.Nb(11,"ion-label"),v.mc(12,"Choose period"),v.Mb(),v.Nb(13,"ion-datetime",4),v.Vb("ngModelChange",function(t){return e.date=t})("ionChange",function(){return e.filter()}),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Nb(14,"ion-content"),v.Nb(15,"ion-grid"),v.Nb(16,"ion-row"),v.Nb(17,"ion-col",2),v.Nb(18,"ion-item-group"),v.Nb(19,"ion-item-divider"),v.Jb(20,"ion-toggle",5,6),v.Nb(22,"ion-label"),v.Nb(23,"h2"),v.mc(24,"Total sold"),v.Mb(),v.Mb(),v.Nb(25,"ion-text",7),v.mc(26),v.Mb(),v.Mb(),v.lc(27,O,3,4,"ng-container",8),v.Mb(),v.Nb(28,"ion-item-group"),v.Nb(29,"ion-item-divider"),v.Jb(30,"ion-toggle",9,10),v.Nb(32,"ion-label",3),v.Nb(33,"h2"),v.mc(34,"Total paid"),v.Mb(),v.Mb(),v.Nb(35,"ion-text",7),v.mc(36),v.Mb(),v.Mb(),v.lc(37,L,3,4,"ng-container",8),v.Mb(),v.Nb(38,"ion-item-group"),v.Nb(39,"ion-item-divider"),v.Jb(40,"ion-toggle",9,11),v.Nb(42,"ion-label",3),v.Nb(43,"h2"),v.mc(44,"Occupancy"),v.Mb(),v.Jb(45,"ion-progress-bar",12),v.Mb(),v.Nb(46,"ion-text",7),v.mc(47),v.Yb(48,"percent"),v.Mb(),v.Mb(),v.lc(49,T,3,4,"ng-container",8),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Mb()),2&t){const t=v.hc(21),a=v.hc(31),o=v.hc(41);v.yb(13),v.dc("max",e.maxDate)("ngModel",e.date),v.yb(13),v.nc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalSold),v.yb(1),v.dc("ngIf",t.checked),v.yb(9),v.nc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalPayments),v.yb(1),v.dc("ngIf",a.checked),v.yb(8),v.dc("value",(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth)),v.yb(2),v.oc(" ",v.ac(48,9,(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth),"2.0-0")," "),v.yb(2),v.dc("ngIf",o.checked)}},directives:[n.q,n.T,n.R,n.g,n.D,n.p,n.J,n.m,n.t,n.z,n.o,n.cb,i.k,i.m,n.n,n.v,n.u,n.S,n.b,n.Q,o.n,n.G,o.m],pipes:[o.p,o.r],styles:[""]}),t})()}];let k=(()=>{class t{}return t.\u0275mod=v.Gb({type:t}),t.\u0275inj=v.Fb({factory:function(e){return new(e||t)},imports:[[s.k.forChild(w)],s.k]}),t})(),j=(()=>{class t{}return t.\u0275mod=v.Gb({type:t}),t.\u0275inj=v.Fb({factory:function(e){return new(e||t)},imports:[[o.c,i.h,n.U,k]]}),t})()}}]);