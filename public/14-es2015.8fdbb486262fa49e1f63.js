(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{zWcS:function(t,e,a){"use strict";a.r(e),a.d(e,"SummaryPageModule",function(){return j});var o=a("ofXK"),i=a("3Pt+"),n=a("TEn/"),s=a("tyNb"),c=a("IjAw"),l=a("OuL/"),r=a("gXqy"),b=a("zHMj"),d=a("EhJz"),m=a("dndX"),h=a("tJKL"),u=a("4dfA"),y=a("mgGq"),M=a("itXk"),p=a("LRne"),g=a("5+tZ"),D=a("zP0r"),v=a("fXoL"),S=a("mrZj"),f=a("l7P3"),N=a("sYmb");function I(t,e){if(1&t){const t=v.Ob();v.Nb(0,"ion-datetime",12),v.Vb("ngModelChange",function(e){return v.jc(t),v.Xb().pickedMonth=e})("ionChange",function(){return v.jc(t),v.Xb().filter()}),v.Mb()}if(2&t){const t=v.Xb();v.ec("monthNames",t.monthNames),v.dc("max",t.maxPickedMonth)("ngModel",t.pickedMonth)}}function O(t,e){if(1&t&&(v.Nb(0,"ion-item",9),v.Nb(1,"ion-label"),v.Nb(2,"p"),v.nc(3),v.Mb(),v.Mb(),v.Nb(4,"ion-text",6),v.nc(5),v.Mb(),v.Mb()),2&t){const t=e.$implicit;v.yb(3),v.oc(t.name),v.yb(2),v.oc(t.analytics.totalSold)}}function k(t,e){if(1&t&&(v.Lb(0),v.mc(1,O,6,2,"ion-item",13),v.Yb(2,"slice"),v.Kb()),2&t){const t=v.Xb();v.yb(1),v.dc("ngForOf",v.ac(2,1,t.calculatedData.rooms,1))}}function Y(t,e){if(1&t&&(v.Nb(0,"ion-item",9),v.Nb(1,"ion-label"),v.Nb(2,"p"),v.nc(3),v.Mb(),v.Mb(),v.Nb(4,"ion-text",6),v.nc(5),v.Mb(),v.Mb()),2&t){const t=e.$implicit;v.yb(3),v.oc(t.name),v.yb(2),v.oc(t.analytics.totalPayments)}}function R(t,e){if(1&t&&(v.Lb(0),v.mc(1,Y,6,2,"ion-item",13),v.Yb(2,"slice"),v.Kb()),2&t){const t=v.Xb();v.yb(1),v.dc("ngForOf",v.ac(2,1,t.calculatedData.rooms,1))}}function T(t,e){if(1&t&&(v.Nb(0,"ion-item",9),v.Nb(1,"ion-label"),v.Nb(2,"p"),v.nc(3),v.Mb(),v.Jb(4,"ion-progress-bar",11),v.Mb(),v.Nb(5,"ion-text",6),v.nc(6),v.Yb(7,"percent"),v.Mb(),v.Mb()),2&t){const t=e.$implicit;v.yb(3),v.oc(t.name),v.yb(1),v.dc("value",t.analytics.totalRoomDays/t.analytics.daysInMonth),v.yb(2),v.pc("",v.ac(7,3,t.analytics.totalRoomDays/t.analytics.daysInMonth,"2.0-0")," ")}}function L(t,e){if(1&t&&(v.Lb(0),v.mc(1,T,8,6,"ion-item",13),v.Yb(2,"slice"),v.Kb()),2&t){const t=v.Xb();v.yb(1),v.dc("ngForOf",v.ac(2,1,t.calculatedData.rooms,1))}}const w=[{path:"",component:(()=>{class t{constructor(t,e,a,o){this.sheduleService=t,this.store=e,this.route=a,this.translate=o,this.pickedMonth=this.sheduleService.convertDateToShort(new Date),this.maxPickedMonth=this.sheduleService.convertDateToShort(c.a(new Date,{years:1})),this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.pickedMonth)),this.calculatedData={rooms:[]},this.updated=!0}ngOnInit(){const t=this.store.select(y.a),e=this.store.select(h.a),a=this.store.select(h.b);t.pipe(Object(g.a)(t=>t?(this.rooms=[...t.rooms],this.rooms.unshift({_id:null,name:"All"}),this.room=this.rooms[0],Object(M.a)([e,a])):Object(p.a)([null,null])),Object(D.a)(1)).subscribe(([t,e])=>{t&&e&&(this.bookings=t,this.payments=e,this.calcData())},t=>console.log("load data err",t)),this.route.url.subscribe(t=>{this.filter(),this.updated=!1,setTimeout(()=>this.updated=!0,1)}),this.translate.stream("elements.datePicker.monthNames").subscribe(t=>{this.updated=!1,this.monthNames=t,setTimeout(()=>this.updated=!0,1)})}calcData(){this.calculatedData.rooms=[];let t=0,e=0,a=0;const o=l.a(this.sheduleService.convertISOToDate(this.pickedMonth))-1;this.rooms.forEach(i=>{if(!i._id)return void this.calculatedData.rooms.push(i);this.calculatedData.rooms.push(i);const n=this.calculatedData.rooms.length-1;let s=0,c=0,l=0;this.payments.forEach(t=>{i._id===t.room_id&&(l+=t.amount)}),this.bookings.forEach(t=>{if(i._id!==t.room_id)return;const e=r.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(t.dates.from)),a=(t.price-t.discount)/e;let o,n,l=0;b.a(this.sheduleService.convertISOToDate(t.dates.from),this.sheduleService.convertISOToDate(this.dateRangeLimits.upper))?l=1:b.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(this.dateRangeLimits.lower))?l=0:(o=d.a(this.sheduleService.convertISOToDate(t.dates.from),this.sheduleService.convertISOToDate(this.dateRangeLimits.lower))||b.a(this.sheduleService.convertISOToDate(t.dates.from),this.sheduleService.convertISOToDate(this.dateRangeLimits.lower))?t.dates.from:this.dateRangeLimits.lower,n=m.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(this.dateRangeLimits.upper))||b.a(this.sheduleService.convertISOToDate(t.dates.to),this.sheduleService.convertISOToDate(this.dateRangeLimits.upper))?t.dates.to:this.dateRangeLimits.upper,l=r.a(this.sheduleService.convertISOToDate(n),this.sheduleService.convertISOToDate(o)),s+=l*a,c+=l)}),this.calculatedData.rooms[n]=Object.assign(Object.assign({},this.calculatedData.rooms[n]),{analytics:{totalSold:s,totalRoomDays:c,daysInMonth:o,totalPayments:l}}),t+=s,e+=c,a+=l}),this.calculatedData.rooms[0]=Object.assign(Object.assign({},this.calculatedData.rooms[0]),{analytics:{totalSold:t,totalRoomDays:e/this.calculatedData.rooms.length,daysInMonth:o,totalPayments:a}})}filter(){const t=this.createBookingQuery(),e=this.createPaymentQuery();this.store.dispatch(new u.a(t)),this.store.dispatch(new u.c(e))}createBookingQuery(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.pickedMonth)),{dateRangeLimits:this.dateRangeLimits,bookingStep:{val:"cancelled",expr:"$ne"}}}createPaymentQuery(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.pickedMonth)),{dateRangeLimits:this.dateRangeLimits}}}return t.\u0275fac=function(e){return new(e||t)(v.Ib(S.a),v.Ib(f.i),v.Ib(s.a),v.Ib(N.d))},t.\u0275cmp=v.Cb({type:t,selectors:[["app-summary"]],decls:55,vars:26,consts:[["slot","end"],["menu","analytics-menu"],["size-md","6","offset-md","3"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","monthNames","ngModelChange","ionChange",4,"ngIf"],["slot","start","color","primary"],["totalSold",""],["slot","end","color","primary"],[4,"ngIf"],["totalPaid",""],["lines","none"],["occupancy",""],["color","primary",3,"value"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","monthNames","ngModelChange","ionChange"],["lines","none",4,"ngFor","ngForOf"]],template:function(t,e){if(1&t&&(v.Nb(0,"ion-header"),v.Nb(1,"ion-toolbar"),v.Nb(2,"ion-title"),v.nc(3),v.Yb(4,"translate"),v.Mb(),v.Nb(5,"ion-buttons",0),v.Jb(6,"ion-menu-button",1),v.Mb(),v.Mb(),v.Nb(7,"ion-toolbar"),v.Nb(8,"ion-grid"),v.Nb(9,"ion-row"),v.Nb(10,"ion-col",2),v.Nb(11,"ion-item"),v.Nb(12,"ion-label"),v.nc(13),v.Yb(14,"translate"),v.Mb(),v.mc(15,I,1,3,"ion-datetime",3),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Nb(16,"ion-content"),v.Nb(17,"ion-grid"),v.Nb(18,"ion-row"),v.Nb(19,"ion-col",2),v.Nb(20,"ion-item-group"),v.Nb(21,"ion-item-divider"),v.Jb(22,"ion-toggle",4,5),v.Nb(24,"ion-label"),v.Nb(25,"h3"),v.nc(26),v.Yb(27,"translate"),v.Mb(),v.Mb(),v.Nb(28,"ion-text",6),v.nc(29),v.Mb(),v.Mb(),v.mc(30,k,3,4,"ng-container",7),v.Mb(),v.Nb(31,"ion-item-group"),v.Nb(32,"ion-item-divider"),v.Jb(33,"ion-toggle",4,8),v.Nb(35,"ion-label",9),v.Nb(36,"h3"),v.nc(37),v.Yb(38,"translate"),v.Mb(),v.Mb(),v.Nb(39,"ion-text",6),v.nc(40),v.Mb(),v.Mb(),v.mc(41,R,3,4,"ng-container",7),v.Mb(),v.Nb(42,"ion-item-group"),v.Nb(43,"ion-item-divider"),v.Jb(44,"ion-toggle",4,10),v.Nb(46,"ion-label",9),v.Nb(47,"h3"),v.nc(48),v.Yb(49,"translate"),v.Mb(),v.Jb(50,"ion-progress-bar",11),v.Mb(),v.Nb(51,"ion-text",6),v.nc(52),v.Yb(53,"percent"),v.Mb(),v.Mb(),v.mc(54,L,3,4,"ng-container",7),v.Mb(),v.Mb(),v.Mb(),v.Mb(),v.Mb()),2&t){const t=v.ic(23),a=v.ic(34),o=v.ic(45);v.yb(3),v.oc(v.Zb(4,13,"modules.analytics.summary.title")),v.yb(10),v.oc(v.Zb(14,15,"elements.datePicker.chooseMonth")),v.yb(2),v.dc("ngIf",e.updated),v.yb(11),v.oc(v.Zb(27,17,"modules.analytics.summary.totalSold")),v.yb(3),v.oc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalSold),v.yb(1),v.dc("ngIf",t.checked),v.yb(7),v.oc(v.Zb(38,19,"modules.analytics.summary.totalPaid")),v.yb(3),v.oc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalPayments),v.yb(1),v.dc("ngIf",a.checked),v.yb(7),v.oc(v.Zb(49,21,"modules.analytics.summary.occupancy")),v.yb(2),v.dc("value",(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth)),v.yb(2),v.pc(" ",v.ac(53,23,(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth),"2.0-0")," "),v.yb(2),v.dc("ngIf",o.checked)}},directives:[n.q,n.S,n.Q,n.g,n.D,n.p,n.J,n.m,n.t,n.z,o.n,n.n,n.v,n.u,n.R,n.b,n.P,n.G,n.o,n.bb,i.k,i.m,o.m],pipes:[N.c,o.p,o.r],styles:[""]}),t})()}];let P=(()=>{class t{}return t.\u0275mod=v.Gb({type:t}),t.\u0275inj=v.Fb({factory:function(e){return new(e||t)},imports:[[s.k.forChild(w)],s.k]}),t})(),j=(()=>{class t{}return t.\u0275mod=v.Gb({type:t}),t.\u0275inj=v.Fb({factory:function(e){return new(e||t)},imports:[[o.c,i.h,n.T,P,N.b.forChild({extend:!0})]]}),t})()}}]);