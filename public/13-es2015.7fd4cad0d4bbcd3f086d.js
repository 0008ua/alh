(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{nhAk:function(e,o,n){"use strict";n.r(o),n.d(o,"ManagementPageModule",function(){return Y});var i=n("ofXK"),t=n("3Pt+"),b=n("TEn/"),r=n("tyNb"),l=n("mrSG"),s=n("IjAw"),c=n("zHMj"),a=n("EhJz"),d=n("dndX"),M=n("lJxs"),g=n("tJKL"),m=n("4dfA"),u=n("mgGq"),p=n("AytR"),h=n("fXoL"),N=n("mrZj"),f=n("l7P3");function y(e,o){if(1&e&&(h.Nb(0,"ion-select-option",14),h.mc(1),h.Mb()),2&e){const e=o.$implicit;h.dc("value",e.key),h.yb(1),h.oc(" ",e.value," ")}}function k(e,o){if(1&e&&(h.Nb(0,"ion-select-option",14),h.mc(1),h.Mb()),2&e){const e=o.$implicit;h.dc("value",e.key),h.yb(1),h.oc(" ",e.value," ")}}function S(e,o){if(1&e&&(h.Nb(0,"ion-select-option",14),h.mc(1),h.Mb()),2&e){const e=o.$implicit;h.dc("value",e),h.yb(1),h.oc("",e.name," ")}}function v(e,o){if(1&e&&(h.Nb(0,"ion-select-option",14),h.mc(1),h.Mb()),2&e){const e=o.$implicit;h.dc("value",e.key),h.yb(1),h.oc(" ",e.value," ")}}function w(e,o){if(1&e&&(h.Nb(0,"ion-select-option",14),h.mc(1),h.Mb()),2&e){const e=o.$implicit;h.dc("value",e.key),h.yb(1),h.oc("",e.value," ")}}function O(e,o){if(1&e){const e=h.Ob();h.Nb(0,"ion-item-options",19),h.Nb(1,"ion-item-option",20),h.Vb("click",function(){h.ic(e);const o=h.Xb().$implicit;return h.Xb().presentAlert(o._id)}),h.Jb(2,"ion-icon",21),h.Mb(),h.Mb()}}function C(e,o){if(1&e){const e=h.Ob();h.Nb(0,"ion-item-options",22),h.Nb(1,"ion-item-option",23),h.Vb("click",function(){h.ic(e);const o=h.Xb().$implicit;return h.Xb().update(o._id)}),h.Jb(2,"ion-icon",24),h.Mb(),h.Mb()}}function D(e,o){if(1&e){const e=h.Ob();h.Lb(0),h.Nb(1,"ion-item-sliding"),h.Nb(2,"ion-item",15),h.Nb(3,"ion-label"),h.Nb(4,"ion-row"),h.Nb(5,"ion-col",9),h.Nb(6,"ion-item",10),h.Nb(7,"ion-label",11),h.Nb(8,"ion-button",16),h.Vb("click",function(){h.ic(e);const n=o.$implicit;return h.Xb().viewBooking(n._id)}),h.mc(9),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Nb(10,"ion-col",9),h.Nb(11,"ion-item",10),h.Nb(12,"ion-label",11),h.mc(13),h.Yb(14,"date"),h.Mb(),h.Mb(),h.Mb(),h.Nb(15,"ion-col",9),h.Nb(16,"ion-item",10),h.Nb(17,"ion-label",11),h.mc(18),h.Yb(19,"date"),h.Mb(),h.Mb(),h.Mb(),h.Nb(20,"ion-col",9),h.Nb(21,"ion-item",10),h.Nb(22,"ion-label",11),h.Nb(23,"ion-text",12),h.mc(24),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.lc(25,O,3,0,"ion-item-options",17),h.lc(26,C,3,0,"ion-item-options",18),h.Mb(),h.Kb()}if(2&e){const e=o.$implicit,n=h.Xb();h.yb(8),h.dc("ngClass","status-color_"+e.bookingStep),h.yb(1),h.nc(e.bookingStep),h.yb(4),h.oc(" ",h.ac(14,7,e.dates.from,"dd MMM")," "),h.yb(5),h.oc(" ",h.ac(19,10,e.dates.to,"dd MMM")," "),h.yb(6),h.oc(" ",e.price," "),h.yb(1),h.dc("ngIf",!(null!=n.user&&n.user.blocked)),h.yb(1),h.dc("ngIf","cancelled"!==e.bookingStep&&!(null!=n.user&&n.user.blocked))}}const F=[{path:"",component:(()=>{class e{constructor(e,o,n,i){this.sheduleService=e,this.store=o,this.router=n,this.alertController=i,this.bookingSteps=p.a.bookingStepsMap,this.bookingStep="cancelled",this.bookingStepExprs=p.a.bookingStepExprsMap,this.bookingStepExpr="$eq",this.sortFields=p.a.sortFieldsMap,this.sortField="dates.from",this.sortOrders=p.a.sortOrdersMap,this.sortOrder=1,this.date=this.sheduleService.convertDateToShort(new Date),this.maxDate=this.sheduleService.convertDateToShort(s.a(new Date,{years:1}))}ngOnInit(){this.store.select(u.a).subscribe(e=>{this.rooms=[...e.rooms],this.rooms.unshift({_id:null,name:"All"}),console.log("rooms",this.rooms),this.room=this.rooms[0]},e=>console.log("load rooms err",e)),this.store.select(u.b).subscribe(e=>this.user=e),this.store.select(g.a).subscribe(e=>{this.bookings=e})}ionViewWillEnter(){const e=this.createBookingQuery();this.store.dispatch(new m.a(e))}presentAlert(e){return Object(l.a)(this,void 0,void 0,function*(){const o=yield this.alertController.create({header:"Delete reservation",subHeader:"Reservation will be deleted",message:"Are you shure?",buttons:[{text:"Cancel",role:"cancel",handler:e=>{}},{text:"Ok",handler:()=>{this.delete(e);const o=this.createBookingQuery();this.store.dispatch(new m.a(o))}}]});yield o.present()})}createBookingQuery(){return{dateRangeLimits:this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.date)),room_id:this.room._id,bookingStep:this.bookingStep?{val:this.bookingStep,expr:this.bookingStepExpr}:null,sort:{field:this.sortField,order:this.sortOrder}}}filter(){const e=this.createBookingQuery();this.store.dispatch(new m.a(e))}getBookings(e,o){return this.store.select(g.a).pipe(Object(M.a)(n=>n.filter(o=>o.room_id===e).map(e=>c.a(new Date(o),new Date(e.dates.from))?Object.assign(Object.assign({},e),{info:"start"}):c.a(new Date(o),new Date(e.dates.to))?Object.assign(Object.assign({},e),{info:"end"}):a.a(new Date(o),new Date(e.dates.from))&&d.a(new Date(o),new Date(e.dates.to))?Object.assign(Object.assign({},e),{info:"ahead"}):void 0).filter(e=>e).sort((e,o)=>new Date(e.dates.from).getTime()-new Date(o.dates.from).getTime()).map(e=>e)))}viewBooking(e){this.router.navigate(["/","shedule","edit",e])}delete(e){this.sheduleService.deleteBooking(e).subscribe(e=>e,e=>console.log("err delete",e))}update(e){this.router.navigateByUrl("/shedule/edit/"+e)}}return e.\u0275fac=function(o){return new(o||e)(h.Ib(N.a),h.Ib(f.i),h.Ib(r.g),h.Ib(b.a))},e.\u0275cmp=h.Cb({type:e,selectors:[["app-management"]],decls:81,vars:22,consts:[["slot","end"],["menu","analytics-menu"],["size-md","8","offset-md","2"],["color","primary","lines","none"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","ngModelChange","ionChange"],["placeholder","Select One",3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Select One",3,"ngModel","disabled","ngModelChange","ionChange"],[1,"ion-no-padding"],["size","3",1,"ion-no-padding"],["lines","none",1,"ion-no-padding"],[1,"ion-text-center"],["color","tertiary"],[4,"ngFor","ngForOf"],[3,"value"],["lines","none"],["fill","clear",3,"ngClass","click"],["side","end",4,"ngIf"],["side","start",4,"ngIf"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash"],["side","start"],["color","primary",3,"click"],["slot","icon-only","name","pencil-outline"]],template:function(e,o){1&e&&(h.Nb(0,"ion-header"),h.Nb(1,"ion-toolbar"),h.Nb(2,"ion-title"),h.mc(3,"Management"),h.Mb(),h.Nb(4,"ion-buttons",0),h.Jb(5,"ion-menu-button",1),h.Mb(),h.Mb(),h.Nb(6,"ion-toolbar"),h.Nb(7,"ion-grid"),h.Nb(8,"ion-row"),h.Nb(9,"ion-col",2),h.Nb(10,"ion-item",3),h.Nb(11,"ion-label"),h.Nb(12,"ion-row"),h.Nb(13,"ion-col"),h.Nb(14,"ion-item"),h.Nb(15,"ion-label"),h.mc(16,"Choose period"),h.Mb(),h.Nb(17,"ion-datetime",4),h.Vb("ngModelChange",function(e){return o.date=e})("ionChange",function(){return o.filter()}),h.Mb(),h.Mb(),h.Mb(),h.Nb(18,"ion-col"),h.Nb(19,"ion-item"),h.Nb(20,"ion-label"),h.mc(21,"Sort"),h.Mb(),h.Nb(22,"ion-select",5),h.Vb("ngModelChange",function(e){return o.sortField=e})("ionChange",function(){return o.filter()}),h.lc(23,y,2,2,"ion-select-option",6),h.Yb(24,"keyvalue"),h.Mb(),h.Mb(),h.Mb(),h.Nb(25,"ion-col"),h.Nb(26,"ion-item"),h.Nb(27,"ion-label"),h.mc(28,"Sort order"),h.Mb(),h.Nb(29,"ion-select",5),h.Vb("ngModelChange",function(e){return o.sortOrder=e})("ionChange",function(){return o.filter()}),h.lc(30,k,2,2,"ion-select-option",6),h.Yb(31,"keyvalue"),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Nb(32,"ion-row"),h.Nb(33,"ion-col"),h.Nb(34,"ion-item"),h.Nb(35,"ion-label"),h.mc(36,"Room"),h.Mb(),h.Nb(37,"ion-select",5),h.Vb("ngModelChange",function(e){return o.room=e})("ionChange",function(){return o.filter()}),h.lc(38,S,2,2,"ion-select-option",6),h.Mb(),h.Mb(),h.Mb(),h.Nb(39,"ion-col"),h.Nb(40,"ion-item"),h.Nb(41,"ion-label"),h.mc(42,"Booking Step"),h.Mb(),h.Nb(43,"ion-select",5),h.Vb("ngModelChange",function(e){return o.bookingStep=e})("ionChange",function(){return o.filter()}),h.lc(44,v,2,2,"ion-select-option",6),h.Yb(45,"keyvalue"),h.Mb(),h.Mb(),h.Mb(),h.Nb(46,"ion-col"),h.Nb(47,"ion-item"),h.Nb(48,"ion-label"),h.mc(49,"Booking Step Equals"),h.Mb(),h.Nb(50,"ion-select",7),h.Vb("ngModelChange",function(e){return o.bookingStepExpr=e})("ionChange",function(){return o.filter()}),h.lc(51,w,2,2,"ion-select-option",6),h.Yb(52,"keyvalue"),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Nb(53,"ion-content"),h.Nb(54,"ion-grid"),h.Nb(55,"ion-row"),h.Nb(56,"ion-col",2),h.Nb(57,"ion-list"),h.Nb(58,"ion-list-header",8),h.Nb(59,"ion-label"),h.Nb(60,"ion-item"),h.Nb(61,"ion-label"),h.Nb(62,"ion-row"),h.Nb(63,"ion-col",9),h.Nb(64,"ion-item",10),h.Nb(65,"ion-label",11),h.mc(66," Step "),h.Mb(),h.Mb(),h.Mb(),h.Nb(67,"ion-col",9),h.Nb(68,"ion-item",10),h.Nb(69,"ion-label",11),h.mc(70," Date form "),h.Mb(),h.Mb(),h.Mb(),h.Nb(71,"ion-col",9),h.Nb(72,"ion-item",10),h.Nb(73,"ion-label",11),h.mc(74," Date to "),h.Mb(),h.Mb(),h.Mb(),h.Nb(75,"ion-col",9),h.Nb(76,"ion-item",10),h.Nb(77,"ion-label",11),h.Nb(78,"ion-text",12),h.mc(79," Price "),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.lc(80,D,27,13,"ng-container",13),h.Mb(),h.Mb(),h.Mb(),h.Mb(),h.Mb()),2&e&&(h.yb(17),h.dc("max",o.maxDate)("ngModel",o.date),h.yb(5),h.dc("ngModel",o.sortField),h.yb(1),h.dc("ngForOf",h.Zb(24,14,o.sortFields)),h.yb(6),h.dc("ngModel",o.sortOrder),h.yb(1),h.dc("ngForOf",h.Zb(31,16,o.sortOrders)),h.yb(7),h.dc("ngModel",o.room),h.yb(1),h.dc("ngForOf",o.rooms),h.yb(5),h.dc("ngModel",o.bookingStep),h.yb(1),h.dc("ngForOf",h.Zb(45,18,o.bookingSteps)),h.yb(6),h.dc("ngModel",o.bookingStepExpr)("disabled",!o.bookingStep),h.yb(1),h.dc("ngForOf",h.Zb(52,20,o.bookingStepExprs)),h.yb(29),h.dc("ngForOf",o.bookings))},directives:[b.q,b.T,b.R,b.g,b.D,b.p,b.J,b.m,b.t,b.z,b.o,b.cb,t.k,t.m,b.K,i.m,b.n,b.A,b.B,b.Q,b.L,b.y,b.f,i.l,i.n,b.x,b.w,b.r],pipes:[i.h,i.e],styles:["ion-label[_ngcontent-%COMP%]{margin:0}"]}),e})()}];let x=(()=>{class e{}return e.\u0275mod=h.Gb({type:e}),e.\u0275inj=h.Fb({factory:function(o){return new(o||e)},imports:[[r.k.forChild(F)],r.k]}),e})(),Y=(()=>{class e{}return e.\u0275mod=h.Gb({type:e}),e.\u0275inj=h.Fb({factory:function(o){return new(o||e)},imports:[[i.c,t.h,t.n,b.U,x]]}),e})()}}]);