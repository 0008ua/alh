(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"73M9":function(e,o,n){"use strict";n.r(o),n.d(o,"ManagementPageModule",function(){return j});var t=n("ofXK"),i=n("3Pt+"),b=n("TEn/"),r=n("tyNb"),l=n("mrSG"),c=n("IjAw"),s=n("zHMj"),a=n("EhJz"),d=n("dndX"),M=n("OuL/"),g=n("9ig3"),u=n("lJxs"),h=n("tJKL"),p=n("4dfA"),m=n("mgGq"),N=n("AytR"),f=n("fXoL"),k=n("mrZj"),y=n("l7P3");function v(e,o){if(1&e&&(f.Nb(0,"ion-select-option",14),f.lc(1),f.Mb()),2&e){const e=o.$implicit;f.dc("value",e.key),f.yb(1),f.nc(" ",e.value," ")}}function S(e,o){if(1&e&&(f.Nb(0,"ion-select-option",14),f.lc(1),f.Mb()),2&e){const e=o.$implicit;f.dc("value",e.key),f.yb(1),f.nc(" ",e.value," ")}}function w(e,o){if(1&e&&(f.Nb(0,"ion-select-option",14),f.lc(1),f.Mb()),2&e){const e=o.$implicit;f.dc("value",e),f.yb(1),f.nc("",e.name," ")}}function O(e,o){if(1&e&&(f.Nb(0,"ion-select-option",14),f.lc(1),f.Mb()),2&e){const e=o.$implicit;f.dc("value",e.key),f.yb(1),f.nc("",e.value," ")}}function C(e,o){if(1&e&&(f.Nb(0,"ion-select-option",14),f.lc(1),f.Mb()),2&e){const e=o.$implicit;f.dc("value",e.key),f.yb(1),f.nc("",e.value," ")}}function D(e,o){if(1&e){const e=f.Ob();f.Nb(0,"ion-item-options",21),f.Nb(1,"ion-item-option",22),f.Vb("click",function(){f.hc(e);const o=f.Xb().$implicit;return f.Xb().update(o._id)}),f.Jb(2,"ion-icon",23),f.Mb(),f.Mb()}}function F(e,o){if(1&e){const e=f.Ob();f.Lb(0),f.Nb(1,"ion-item-sliding"),f.Nb(2,"ion-item",15),f.Nb(3,"ion-label"),f.Nb(4,"ion-row"),f.Nb(5,"ion-col",10),f.Nb(6,"ion-item",11),f.Nb(7,"ion-label",8),f.Nb(8,"ion-button",16),f.Vb("click",function(){f.hc(e);const n=o.$implicit;return f.Xb().viewBooking(n._id)}),f.lc(9),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Nb(10,"ion-col",10),f.Nb(11,"ion-item",11),f.Nb(12,"ion-label",8),f.lc(13),f.Yb(14,"date"),f.Mb(),f.Mb(),f.Mb(),f.Nb(15,"ion-col",10),f.Nb(16,"ion-item",11),f.Nb(17,"ion-label",8),f.lc(18),f.Yb(19,"date"),f.Mb(),f.Mb(),f.Mb(),f.Nb(20,"ion-col",10),f.Nb(21,"ion-item",11),f.Nb(22,"ion-label",8),f.Nb(23,"ion-text",12),f.lc(24),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Nb(25,"ion-item-options",17),f.Nb(26,"ion-item-option",18),f.Vb("click",function(){f.hc(e);const n=o.$implicit;return f.Xb().presentAlert(n._id)}),f.Jb(27,"ion-icon",19),f.Mb(),f.Mb(),f.kc(28,D,3,0,"ion-item-options",20),f.Mb(),f.Kb()}if(2&e){const e=o.$implicit;f.yb(9),f.mc(e.bookingStep),f.yb(4),f.nc(" ",f.ac(14,5,e.dates.from,"dd MMM")," "),f.yb(5),f.nc(" ",f.ac(19,8,e.dates.to,"dd MMM")," "),f.yb(6),f.nc(" ",e.price," "),f.yb(4),f.dc("ngIf","cancelled"!==e.bookingStep)}}const x=[{path:"",component:(()=>{class e{constructor(e,o,n,t){this.sheduleService=e,this.store=o,this.router=n,this.alertController=t,this.bookingSteps=N.a.bookingStepsMap,this.bookingStep="cancelled",this.bookingStepExprs=N.a.bookingStepExprsMap,this.bookingStepExpr="$eq",this.sortFields=N.a.sortFieldsMap,this.sortField="dates.from",this.sortOrders=N.a.sortOrdersMap,this.sortOrder=1,this.date=this.sheduleService.convertDateToShort(new Date),this.maxDate=this.sheduleService.convertDateToShort(c.a(new Date,{years:1}))}ngOnInit(){this.store.select(m.a).subscribe(e=>{this.rooms=[...e.rooms],this.rooms.unshift({_id:null,name:"All"}),console.log("rooms",this.rooms),this.room=this.rooms[0]},e=>console.log("load rooms err",e)),this.store.select(h.a).subscribe(e=>{this.bookings=e})}ionViewWillEnter(){const e=this.createBookingQuery();this.store.dispatch(new p.a(e))}presentAlert(e){return Object(l.a)(this,void 0,void 0,function*(){const o=yield this.alertController.create({header:"Delete reservation",subHeader:"Reservation will be deleted",message:"Are you shure?",buttons:[{text:"Cancel",role:"cancel",handler:e=>{}},{text:"Ok",handler:()=>{this.delete(e);const o=this.createBookingQuery();this.store.dispatch(new p.a(o))}}]});yield o.present()})}createBookingQuery(){return{dateRange:this.createRangeLimits(this.sheduleService.convertShortToDate(this.date)),room_id:this.room._id,bookingStep:this.bookingStep?{val:this.bookingStep,expr:this.bookingStepExpr}:null,sort:{field:this.sortField,order:this.sortOrder}}}filter(){const e=this.createBookingQuery();this.store.dispatch(new p.a(e))}getBookings(e,o){return this.store.select(h.a).pipe(Object(u.a)(n=>n.filter(o=>o.room_id===e).map(e=>s.a(new Date(o),new Date(e.dates.from))?Object.assign(Object.assign({},e),{info:"start"}):s.a(new Date(o),new Date(e.dates.to))?Object.assign(Object.assign({},e),{info:"end"}):a.a(new Date(o),new Date(e.dates.from))&&d.a(new Date(o),new Date(e.dates.to))?Object.assign(Object.assign({},e),{info:"ahead"}):void 0).filter(e=>e).sort((e,o)=>new Date(e.dates.from).getTime()-new Date(o.dates.from).getTime()).map(e=>e)))}createRangeLimits(e){const o=M.a(e),n=g.a(e),t=c.a(n,{days:o-1});return{lower:this.sheduleService.convertDateToShort(n),upper:this.sheduleService.convertDateToShort(t)}}viewBooking(e){this.router.navigate(["/","shedule","discover",e])}delete(e){this.sheduleService.deleteBooking(e).subscribe(e=>e,e=>console.log("err delete",e))}update(e){this.router.navigateByUrl("/shedule/edit/"+e)}}return e.\u0275fac=function(o){return new(o||e)(f.Ib(k.a),f.Ib(y.i),f.Ib(r.g),f.Ib(b.a))},e.\u0275cmp=f.Cb({type:e,selectors:[["app-management"]],decls:83,vars:22,consts:[["slot","end"],["contentId","main-content"],["size-md","8","offset-md","2"],["color","primary","lines","none"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","ngModelChange","ionChange"],["placeholder","Select One",3,"ngModel","ngModelChange","ionChange"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Select One",3,"ngModel","disabled","ngModelChange","ionChange"],[1,"ion-text-center"],[1,"ion-no-padding"],["size","3",1,"ion-no-padding"],["lines","none",1,"ion-no-padding"],["color","tertiary"],[4,"ngFor","ngForOf"],[3,"value"],["lines","none"],["fill","clear",3,"click"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash"],["side","start",4,"ngIf"],["side","start"],["color","primary",3,"click"],["slot","icon-only","name","pencil-outline"]],template:function(e,o){1&e&&(f.Nb(0,"ion-header"),f.Nb(1,"ion-toolbar"),f.Nb(2,"ion-title"),f.lc(3,"Management"),f.Mb(),f.Nb(4,"ion-buttons",0),f.Jb(5,"ion-menu-button",1),f.Mb(),f.Mb(),f.Nb(6,"ion-toolbar"),f.Nb(7,"ion-grid"),f.Nb(8,"ion-row"),f.Nb(9,"ion-col",2),f.Nb(10,"ion-item",3),f.Nb(11,"ion-label"),f.Nb(12,"ion-row"),f.Nb(13,"ion-col"),f.Nb(14,"ion-item"),f.Nb(15,"ion-label"),f.lc(16,"Choose period"),f.Mb(),f.Nb(17,"ion-datetime",4),f.Vb("ngModelChange",function(e){return o.date=e})("ionChange",function(){return o.filter()}),f.Mb(),f.Mb(),f.Mb(),f.Nb(18,"ion-col"),f.Nb(19,"ion-item"),f.Nb(20,"ion-label"),f.lc(21,"Sort"),f.Mb(),f.Nb(22,"ion-select",5),f.Vb("ngModelChange",function(e){return o.sortField=e})("ionChange",function(){return o.filter()}),f.kc(23,v,2,2,"ion-select-option",6),f.Yb(24,"keyvalue"),f.Mb(),f.Mb(),f.Mb(),f.Nb(25,"ion-col"),f.Nb(26,"ion-item"),f.Nb(27,"ion-label"),f.lc(28,"Sort order"),f.Mb(),f.Nb(29,"ion-select",5),f.Vb("ngModelChange",function(e){return o.sortOrder=e})("ionChange",function(){return o.filter()}),f.kc(30,S,2,2,"ion-select-option",6),f.Yb(31,"keyvalue"),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Nb(32,"ion-row"),f.Nb(33,"ion-col"),f.Nb(34,"ion-item"),f.Nb(35,"ion-label"),f.lc(36,"Room"),f.Mb(),f.Nb(37,"ion-select",5),f.Vb("ngModelChange",function(e){return o.room=e})("ionChange",function(){return o.filter()}),f.kc(38,w,2,2,"ion-select-option",6),f.Mb(),f.Mb(),f.Mb(),f.Nb(39,"ion-col"),f.Nb(40,"ion-item"),f.Nb(41,"ion-label"),f.lc(42,"Booking Step"),f.Mb(),f.Nb(43,"ion-select",5),f.Vb("ngModelChange",function(e){return o.bookingStep=e})("ionChange",function(){return o.filter()}),f.kc(44,O,2,2,"ion-select-option",6),f.Yb(45,"keyvalue"),f.Mb(),f.Mb(),f.Mb(),f.Nb(46,"ion-col"),f.Nb(47,"ion-item"),f.Nb(48,"ion-label"),f.lc(49,"Booking Step Equals"),f.Mb(),f.Nb(50,"ion-select",7),f.Vb("ngModelChange",function(e){return o.bookingStepExpr=e})("ionChange",function(){return o.filter()}),f.kc(51,C,2,2,"ion-select-option",6),f.Yb(52,"keyvalue"),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Nb(53,"ion-content"),f.Nb(54,"ion-grid"),f.Nb(55,"ion-row"),f.Nb(56,"ion-col",2),f.Nb(57,"h2",8),f.lc(58,"Title"),f.Mb(),f.Nb(59,"ion-list"),f.Nb(60,"ion-list-header",9),f.Nb(61,"ion-label"),f.Nb(62,"ion-item"),f.Nb(63,"ion-label"),f.Nb(64,"ion-row"),f.Nb(65,"ion-col",10),f.Nb(66,"ion-item",11),f.Nb(67,"ion-label",8),f.lc(68," Step "),f.Mb(),f.Mb(),f.Mb(),f.Nb(69,"ion-col",10),f.Nb(70,"ion-item",11),f.Nb(71,"ion-label",8),f.lc(72," Date form "),f.Mb(),f.Mb(),f.Mb(),f.Nb(73,"ion-col",10),f.Nb(74,"ion-item",11),f.Nb(75,"ion-label",8),f.lc(76," Date to "),f.Mb(),f.Mb(),f.Mb(),f.Nb(77,"ion-col",10),f.Nb(78,"ion-item",11),f.Nb(79,"ion-label",8),f.Nb(80,"ion-text",12),f.lc(81," Price "),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.kc(82,F,29,11,"ng-container",13),f.Mb(),f.Mb(),f.Mb(),f.Mb(),f.Mb()),2&e&&(f.yb(17),f.dc("max",o.maxDate)("ngModel",o.date),f.yb(5),f.dc("ngModel",o.sortField),f.yb(1),f.dc("ngForOf",f.Zb(24,14,o.sortFields)),f.yb(6),f.dc("ngModel",o.sortOrder),f.yb(1),f.dc("ngForOf",f.Zb(31,16,o.sortOrders)),f.yb(7),f.dc("ngModel",o.room),f.yb(1),f.dc("ngForOf",o.rooms),f.yb(5),f.dc("ngModel",o.bookingStep),f.yb(1),f.dc("ngForOf",f.Zb(45,18,o.bookingSteps)),f.yb(6),f.dc("ngModel",o.bookingStepExpr)("disabled",!o.bookingStep),f.yb(1),f.dc("ngForOf",f.Zb(52,20,o.bookingStepExprs)),f.yb(31),f.dc("ngForOf",o.bookings))},directives:[b.p,b.O,b.N,b.f,b.A,b.o,b.G,b.l,b.s,b.w,b.n,b.W,i.k,i.m,b.H,t.m,b.m,b.x,b.y,b.M,b.I,b.v,b.e,b.u,b.t,b.q,t.n],pipes:[t.h,t.e],styles:["ion-label[_ngcontent-%COMP%]{margin:0}"]}),e})()}];let Y=(()=>{class e{}return e.\u0275mod=f.Gb({type:e}),e.\u0275inj=f.Fb({factory:function(o){return new(o||e)},imports:[[r.k.forChild(x)],r.k]}),e})(),j=(()=>{class e{}return e.\u0275mod=f.Gb({type:e}),e.\u0275inj=f.Fb({factory:function(o){return new(o||e)},imports:[[t.c,i.h,i.n,b.P,Y]]}),e})()}}]);