!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var a=[],o=!0,n=!1,i=void 0;try{for(var r,c=t[Symbol.iterator]();!(o=(r=c.next()).done)&&(a.push(r.value),!e||a.length!==e);o=!0);}catch(l){n=!0,i=l}finally{try{o||null==c.return||c.return()}finally{if(n)throw i}}return a}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return o(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,o=new Array(e);a<e;a++)o[a]=t[a];return o}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{zWcS:function(a,o,r){"use strict";r.r(o),r.d(o,"SummaryPageModule",function(){return E});var c=r("ofXK"),l=r("3Pt+"),s=r("TEn/"),u=r("tyNb"),b=r("IjAw"),d=r("OuL/"),m=r("gXqy"),h=r("zHMj"),y=r("EhJz"),f=r("dndX"),v=r("tJKL"),p=r("4dfA"),M=r("mgGq"),g=r("itXk"),S=r("LRne"),D=r("5+tZ"),N=r("zP0r"),I=r("fXoL"),O=r("mrZj"),k=r("l7P3"),w=r("sYmb");function T(t,e){if(1&t){var a=I.Ob();I.Nb(0,"ion-datetime",12),I.Vb("ngModelChange",function(t){return I.jc(a),I.Xb().pickedMonth=t})("ionChange",function(){return I.jc(a),I.Xb().filter()}),I.Mb()}if(2&t){var o=I.Xb();I.ec("monthNames",o.monthNames),I.dc("max",o.maxPickedMonth)("ngModel",o.pickedMonth)}}function Y(t,e){if(1&t&&(I.Nb(0,"ion-item",9),I.Nb(1,"ion-label"),I.Nb(2,"p"),I.nc(3),I.Mb(),I.Mb(),I.Nb(4,"ion-text",6),I.nc(5),I.Mb(),I.Mb()),2&t){var a=e.$implicit;I.yb(3),I.oc(a.name),I.yb(2),I.oc(a.analytics.totalSold)}}function R(t,e){if(1&t&&(I.Lb(0),I.mc(1,Y,6,2,"ion-item",13),I.Yb(2,"slice"),I.Kb()),2&t){var a=I.Xb();I.yb(1),I.dc("ngForOf",I.ac(2,1,a.calculatedData.rooms,1))}}function L(t,e){if(1&t&&(I.Nb(0,"ion-item",9),I.Nb(1,"ion-label"),I.Nb(2,"p"),I.nc(3),I.Mb(),I.Mb(),I.Nb(4,"ion-text",6),I.nc(5),I.Mb(),I.Mb()),2&t){var a=e.$implicit;I.yb(3),I.oc(a.name),I.yb(2),I.oc(a.analytics.totalPayments)}}function j(t,e){if(1&t&&(I.Lb(0),I.mc(1,L,6,2,"ion-item",13),I.Yb(2,"slice"),I.Kb()),2&t){var a=I.Xb();I.yb(1),I.dc("ngForOf",I.ac(2,1,a.calculatedData.rooms,1))}}function P(t,e){if(1&t&&(I.Nb(0,"ion-item",9),I.Nb(1,"ion-label"),I.Nb(2,"p"),I.nc(3),I.Mb(),I.Jb(4,"ion-progress-bar",11),I.Mb(),I.Nb(5,"ion-text",6),I.nc(6),I.Yb(7,"percent"),I.Mb(),I.Mb()),2&t){var a=e.$implicit;I.yb(3),I.oc(a.name),I.yb(1),I.dc("value",a.analytics.totalRoomDays/a.analytics.daysInMonth),I.yb(2),I.pc("",I.ac(7,3,a.analytics.totalRoomDays/a.analytics.daysInMonth,"2.0-0")," ")}}function x(t,e){if(1&t&&(I.Lb(0),I.mc(1,P,8,6,"ion-item",13),I.Yb(2,"slice"),I.Kb()),2&t){var a=I.Xb();I.yb(1),I.dc("ngForOf",I.ac(2,1,a.calculatedData.rooms,1))}}var A,C,F,J=[{path:"",component:(A=function(){function a(t,e,o,i){n(this,a),this.sheduleService=t,this.store=e,this.route=o,this.translate=i,this.pickedMonth=this.sheduleService.convertDateToShort(new Date),this.maxPickedMonth=this.sheduleService.convertDateToShort(b.a(new Date,{years:1})),this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.pickedMonth)),this.calculatedData={rooms:[]},this.updated=!0}var o,r,c;return o=a,(r=[{key:"ngOnInit",value:function(){var a=this,o=this.store.select(M.a),n=this.store.select(v.a),i=this.store.select(v.b);o.pipe(Object(D.a)(function(t){return t?(a.rooms=e(t.rooms),a.rooms.unshift({_id:null,name:"All"}),a.room=a.rooms[0],Object(g.a)([n,i])):Object(S.a)([null,null])}),Object(N.a)(1)).subscribe(function(e){var o=t(e,2),n=o[0],i=o[1];n&&i&&(a.bookings=n,a.payments=i,a.calcData())},function(t){return console.log("load data err",t)}),this.route.url.subscribe(function(t){a.filter(),a.updated=!1,setTimeout(function(){return a.updated=!0},1)}),this.translate.stream("elements.datePicker.monthNames").subscribe(function(t){a.updated=!1,a.monthNames=t,setTimeout(function(){return a.updated=!0},1)})}},{key:"calcData",value:function(){var t=this;this.calculatedData.rooms=[];var e=0,a=0,o=0,n=d.a(this.sheduleService.convertISOToDate(this.pickedMonth))-1;this.rooms.forEach(function(i){if(i._id){t.calculatedData.rooms.push(i);var r=t.calculatedData.rooms.length-1,c=0,l=0,s=0;t.payments.forEach(function(t){i._id===t.room_id&&(s+=t.amount)}),t.bookings.forEach(function(e){if(i._id===e.room_id){var a,o,n=m.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(e.dates.from)),r=(e.price-e.discount)/n,s=0;h.a(t.sheduleService.convertISOToDate(e.dates.from),t.sheduleService.convertISOToDate(t.dateRangeLimits.upper))?s=1:h.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(t.dateRangeLimits.lower))?s=0:(a=y.a(t.sheduleService.convertISOToDate(e.dates.from),t.sheduleService.convertISOToDate(t.dateRangeLimits.lower))||h.a(t.sheduleService.convertISOToDate(e.dates.from),t.sheduleService.convertISOToDate(t.dateRangeLimits.lower))?e.dates.from:t.dateRangeLimits.lower,o=f.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(t.dateRangeLimits.upper))||h.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(t.dateRangeLimits.upper))?e.dates.to:t.dateRangeLimits.upper,s=m.a(t.sheduleService.convertISOToDate(o),t.sheduleService.convertISOToDate(a)),c+=s*r,l+=s)}}),t.calculatedData.rooms[r]=Object.assign(Object.assign({},t.calculatedData.rooms[r]),{analytics:{totalSold:c,totalRoomDays:l,daysInMonth:n,totalPayments:s}}),e+=c,a+=l,o+=s}else t.calculatedData.rooms.push(i)}),this.calculatedData.rooms[0]=Object.assign(Object.assign({},this.calculatedData.rooms[0]),{analytics:{totalSold:e,totalRoomDays:a/this.calculatedData.rooms.length,daysInMonth:n,totalPayments:o}})}},{key:"filter",value:function(){var t=this.createBookingQuery(),e=this.createPaymentQuery();this.store.dispatch(new p.a(t)),this.store.dispatch(new p.c(e))}},{key:"createBookingQuery",value:function(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.pickedMonth)),{dateRangeLimits:this.dateRangeLimits,bookingStep:{val:"cancelled",expr:"$ne"}}}},{key:"createPaymentQuery",value:function(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.pickedMonth)),{dateRangeLimits:this.dateRangeLimits}}}])&&i(o.prototype,r),c&&i(o,c),a}(),A.\u0275fac=function(t){return new(t||A)(I.Ib(O.a),I.Ib(k.i),I.Ib(u.a),I.Ib(w.d))},A.\u0275cmp=I.Cb({type:A,selectors:[["app-summary"]],decls:55,vars:26,consts:[["slot","end"],["menu","analytics-menu"],["size-md","6","offset-md","3"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","monthNames","ngModelChange","ionChange",4,"ngIf"],["slot","start","color","primary"],["totalSold",""],["slot","end","color","primary"],[4,"ngIf"],["totalPaid",""],["lines","none"],["occupancy",""],["color","primary",3,"value"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","monthNames","ngModelChange","ionChange"],["lines","none",4,"ngFor","ngForOf"]],template:function(t,e){if(1&t&&(I.Nb(0,"ion-header"),I.Nb(1,"ion-toolbar"),I.Nb(2,"ion-title"),I.nc(3),I.Yb(4,"translate"),I.Mb(),I.Nb(5,"ion-buttons",0),I.Jb(6,"ion-menu-button",1),I.Mb(),I.Mb(),I.Nb(7,"ion-toolbar"),I.Nb(8,"ion-grid"),I.Nb(9,"ion-row"),I.Nb(10,"ion-col",2),I.Nb(11,"ion-item"),I.Nb(12,"ion-label"),I.nc(13),I.Yb(14,"translate"),I.Mb(),I.mc(15,T,1,3,"ion-datetime",3),I.Mb(),I.Mb(),I.Mb(),I.Mb(),I.Mb(),I.Mb(),I.Nb(16,"ion-content"),I.Nb(17,"ion-grid"),I.Nb(18,"ion-row"),I.Nb(19,"ion-col",2),I.Nb(20,"ion-item-group"),I.Nb(21,"ion-item-divider"),I.Jb(22,"ion-toggle",4,5),I.Nb(24,"ion-label"),I.Nb(25,"h3"),I.nc(26),I.Yb(27,"translate"),I.Mb(),I.Mb(),I.Nb(28,"ion-text",6),I.nc(29),I.Mb(),I.Mb(),I.mc(30,R,3,4,"ng-container",7),I.Mb(),I.Nb(31,"ion-item-group"),I.Nb(32,"ion-item-divider"),I.Jb(33,"ion-toggle",4,8),I.Nb(35,"ion-label",9),I.Nb(36,"h3"),I.nc(37),I.Yb(38,"translate"),I.Mb(),I.Mb(),I.Nb(39,"ion-text",6),I.nc(40),I.Mb(),I.Mb(),I.mc(41,j,3,4,"ng-container",7),I.Mb(),I.Nb(42,"ion-item-group"),I.Nb(43,"ion-item-divider"),I.Jb(44,"ion-toggle",4,10),I.Nb(46,"ion-label",9),I.Nb(47,"h3"),I.nc(48),I.Yb(49,"translate"),I.Mb(),I.Jb(50,"ion-progress-bar",11),I.Mb(),I.Nb(51,"ion-text",6),I.nc(52),I.Yb(53,"percent"),I.Mb(),I.Mb(),I.mc(54,x,3,4,"ng-container",7),I.Mb(),I.Mb(),I.Mb(),I.Mb(),I.Mb()),2&t){var a=I.ic(23),o=I.ic(34),n=I.ic(45);I.yb(3),I.oc(I.Zb(4,13,"modules.analytics.summary.title")),I.yb(10),I.oc(I.Zb(14,15,"elements.datePicker.chooseMonth")),I.yb(2),I.dc("ngIf",e.updated),I.yb(11),I.oc(I.Zb(27,17,"modules.analytics.summary.totalSold")),I.yb(3),I.oc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalSold),I.yb(1),I.dc("ngIf",a.checked),I.yb(7),I.oc(I.Zb(38,19,"modules.analytics.summary.totalPaid")),I.yb(3),I.oc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalPayments),I.yb(1),I.dc("ngIf",o.checked),I.yb(7),I.oc(I.Zb(49,21,"modules.analytics.summary.occupancy")),I.yb(2),I.dc("value",(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth)),I.yb(2),I.pc(" ",I.ac(53,23,(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth),"2.0-0")," "),I.yb(2),I.dc("ngIf",n.checked)}},directives:[s.q,s.S,s.Q,s.g,s.D,s.p,s.J,s.m,s.t,s.z,c.n,s.n,s.v,s.u,s.R,s.b,s.P,s.G,s.o,s.bb,l.k,l.m,c.m],pipes:[w.c,c.p,c.r],styles:[""]}),A)}],X=((F=function t(){n(this,t)}).\u0275mod=I.Gb({type:F}),F.\u0275inj=I.Fb({factory:function(t){return new(t||F)},imports:[[u.k.forChild(J)],u.k]}),F),E=((C=function t(){n(this,t)}).\u0275mod=I.Gb({type:C}),C.\u0275inj=I.Fb({factory:function(t){return new(t||C)},imports:[[c.c,l.h,s.T,X,w.b.forChild({extend:!0})]]}),C)}}])}();