!function(){function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var a=[],o=!0,n=!1,i=void 0;try{for(var r,c=t[Symbol.iterator]();!(o=(r=c.next()).done)&&(a.push(r.value),!e||a.length!==e);o=!0);}catch(l){n=!0,i=l}finally{try{o||null==c.return||c.return()}finally{if(n)throw i}}return a}(t,e)||a(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){if(t){if("string"==typeof t)return o(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(t,e):void 0}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,o=new Array(e);a<e;a++)o[a]=t[a];return o}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{zWcS:function(a,o,r){"use strict";r.r(o),r.d(o,"SummaryPageModule",function(){return F});var c=r("ofXK"),l=r("3Pt+"),s=r("TEn/"),u=r("tyNb"),b=r("IjAw"),d=r("OuL/"),m=r("gXqy"),h=r("zHMj"),y=r("EhJz"),f=r("dndX"),v=r("tJKL"),g=r("4dfA"),p=r("mgGq"),D=r("itXk"),S=r("LRne"),M=r("5+tZ"),N=r("zP0r"),O=r("fXoL"),I=r("mrZj"),w=r("l7P3");function T(t,e){if(1&t&&(O.Nb(0,"ion-item",3),O.Nb(1,"ion-label"),O.Nb(2,"p"),O.mc(3),O.Mb(),O.Mb(),O.Nb(4,"ion-text",7),O.mc(5),O.Mb(),O.Mb()),2&t){var a=e.$implicit;O.yb(3),O.nc(a.name),O.yb(2),O.nc(a.analytics.totalSold)}}function L(t,e){if(1&t&&(O.Lb(0),O.lc(1,T,6,2,"ion-item",13),O.Yb(2,"slice"),O.Kb()),2&t){var a=O.Xb();O.yb(1),O.dc("ngForOf",O.ac(2,1,a.calculatedData.rooms,1))}}function R(t,e){if(1&t&&(O.Nb(0,"ion-item",3),O.Nb(1,"ion-label"),O.Nb(2,"p"),O.mc(3),O.Mb(),O.Mb(),O.Nb(4,"ion-text",7),O.mc(5),O.Mb(),O.Mb()),2&t){var a=e.$implicit;O.yb(3),O.nc(a.name),O.yb(2),O.nc(a.analytics.totalPayments)}}function k(t,e){if(1&t&&(O.Lb(0),O.lc(1,R,6,2,"ion-item",13),O.Yb(2,"slice"),O.Kb()),2&t){var a=O.Xb();O.yb(1),O.dc("ngForOf",O.ac(2,1,a.calculatedData.rooms,1))}}function j(t,e){if(1&t&&(O.Nb(0,"ion-item",3),O.Nb(1,"ion-label"),O.Nb(2,"p"),O.mc(3),O.Mb(),O.Jb(4,"ion-progress-bar",12),O.Mb(),O.Nb(5,"ion-text",7),O.mc(6),O.Yb(7,"percent"),O.Mb(),O.Mb()),2&t){var a=e.$implicit;O.yb(3),O.nc(a.name),O.yb(1),O.dc("value",a.analytics.totalRoomDays/a.analytics.daysInMonth),O.yb(2),O.oc("",O.ac(7,3,a.analytics.totalRoomDays/a.analytics.daysInMonth,"2.0-0")," ")}}function Y(t,e){if(1&t&&(O.Lb(0),O.lc(1,j,8,6,"ion-item",13),O.Yb(2,"slice"),O.Kb()),2&t){var a=O.Xb();O.yb(1),O.dc("ngForOf",O.ac(2,1,a.calculatedData.rooms,1))}}var x,A,P,J=[{path:"",component:(x=function(){function a(t,e,o){n(this,a),this.sheduleService=t,this.store=e,this.route=o,this.date=this.sheduleService.convertDateToShort(new Date),this.maxDate=this.sheduleService.convertDateToShort(b.a(new Date,{years:1})),this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.date)),this.calculatedData={rooms:[]}}var o,r,c;return o=a,(r=[{key:"ngOnChanges",value:function(){console.log("asdasd")}},{key:"ngOnInit",value:function(){var a=this,o=this.store.select(p.a),n=this.store.select(v.a),i=this.store.select(v.b);o.pipe(Object(M.a)(function(t){return console.log("company summary",t),t?(console.log("combineLatest"),a.rooms=e(t.rooms),a.rooms.unshift({_id:null,name:"All"}),a.room=a.rooms[0],Object(D.a)([n,i])):Object(S.a)([null,null])}),Object(N.a)(1)).subscribe(function(e){var o=t(e,2),n=o[0],i=o[1];n&&i&&(console.log("bookings summary",n),console.log("payments summary",i),a.bookings=n,a.payments=i,a.calcData())},function(t){return console.log("load data err",t)}),this.route.url.subscribe(function(t){console.log("url"),a.filter()})}},{key:"calcData",value:function(){var t=this;console.log("calc"),this.calculatedData.rooms=[];var e=0,a=0,o=0,n=d.a(this.sheduleService.convertISOToDate(this.date))-1;this.rooms.forEach(function(i){if(i._id){t.calculatedData.rooms.push(i);var r=t.calculatedData.rooms.length-1,c=0,l=0,s=0;t.payments.forEach(function(t){i._id!==t.room_id&&(s+=t.amount)}),t.bookings.forEach(function(e){if(i._id!==e.room_id){var a,o,n=m.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(e.dates.from)),r=(e.price-e.discount)/n,s=0;h.a(t.sheduleService.convertISOToDate(e.dates.from),t.sheduleService.convertISOToDate(t.dateRangeLimits.upper))?s=1:h.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(t.dateRangeLimits.lower))?s=0:(a=y.a(t.sheduleService.convertISOToDate(e.dates.from),t.sheduleService.convertISOToDate(t.dateRangeLimits.lower))||h.a(t.sheduleService.convertISOToDate(e.dates.from),t.sheduleService.convertISOToDate(t.dateRangeLimits.lower))?e.dates.from:t.dateRangeLimits.lower,o=f.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(t.dateRangeLimits.upper))||h.a(t.sheduleService.convertISOToDate(e.dates.to),t.sheduleService.convertISOToDate(t.dateRangeLimits.upper))?e.dates.to:t.dateRangeLimits.upper,s=m.a(t.sheduleService.convertISOToDate(o),t.sheduleService.convertISOToDate(a)),c+=s*r,l+=s)}}),t.calculatedData.rooms[r]=Object.assign(Object.assign({},t.calculatedData.rooms[r]),{analytics:{totalSold:c,totalRoomDays:l,daysInMonth:n,totalPayments:s}}),e+=c,a+=l,o+=s}else t.calculatedData.rooms.push(i)}),this.calculatedData.rooms[0]=Object.assign(Object.assign({},this.calculatedData.rooms[0]),{analytics:{totalSold:e,totalRoomDays:a/this.calculatedData.rooms.length,daysInMonth:n,totalPayments:o}}),console.log("this.calculatedData.rooms",this.calculatedData.rooms)}},{key:"filter",value:function(){var t=this.createBookingQuery(),e=this.createPaymentQuery();this.store.dispatch(new g.a(t)),this.store.dispatch(new g.c(e))}},{key:"createBookingQuery",value:function(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.date)),{dateRangeLimits:this.dateRangeLimits,bookingStep:{val:"cancelled",expr:"$ne"}}}},{key:"createPaymentQuery",value:function(){return this.dateRangeLimits=this.sheduleService.createDateRangeLimits(this.sheduleService.convertISOToDate(this.date)),{dateRangeLimits:this.dateRangeLimits}}}])&&i(o.prototype,r),c&&i(o,c),a}(),x.\u0275fac=function(t){return new(t||x)(O.Ib(I.a),O.Ib(w.i),O.Ib(u.a))},x.\u0275cmp=O.Cb({type:x,selectors:[["app-summary"]],features:[O.wb],decls:50,vars:12,consts:[["slot","end"],["menu","analytics-menu"],["size-md","6","offset-md","3"],["lines","none"],["pickerFormat","MMMM-YYYY","displayFormat","MMMM YYYY","placeholder","Select Month",3,"max","ngModel","ngModelChange","ionChange"],["slot","start","color","primary","checked",""],["totalSold",""],["slot","end","color","primary"],[4,"ngIf"],["slot","start","color","primary"],["totalPaid",""],["occupancy",""],["color","primary",3,"value"],["lines","none",4,"ngFor","ngForOf"]],template:function(t,e){if(1&t&&(O.Nb(0,"ion-header"),O.Nb(1,"ion-toolbar"),O.Nb(2,"ion-title"),O.mc(3,"Summary"),O.Mb(),O.Nb(4,"ion-buttons",0),O.Jb(5,"ion-menu-button",1),O.Mb(),O.Mb(),O.Nb(6,"ion-toolbar"),O.Nb(7,"ion-grid"),O.Nb(8,"ion-row"),O.Nb(9,"ion-col",2),O.Nb(10,"ion-item",3),O.Nb(11,"ion-label"),O.mc(12,"Choose period"),O.Mb(),O.Nb(13,"ion-datetime",4),O.Vb("ngModelChange",function(t){return e.date=t})("ionChange",function(){return e.filter()}),O.Mb(),O.Mb(),O.Mb(),O.Mb(),O.Mb(),O.Mb(),O.Mb(),O.Nb(14,"ion-content"),O.Nb(15,"ion-grid"),O.Nb(16,"ion-row"),O.Nb(17,"ion-col",2),O.Nb(18,"ion-item-group"),O.Nb(19,"ion-item-divider"),O.Jb(20,"ion-toggle",5,6),O.Nb(22,"ion-label"),O.Nb(23,"h2"),O.mc(24,"Total sold"),O.Mb(),O.Mb(),O.Nb(25,"ion-text",7),O.mc(26),O.Mb(),O.Mb(),O.lc(27,L,3,4,"ng-container",8),O.Mb(),O.Nb(28,"ion-item-group"),O.Nb(29,"ion-item-divider"),O.Jb(30,"ion-toggle",9,10),O.Nb(32,"ion-label",3),O.Nb(33,"h2"),O.mc(34,"Total paid"),O.Mb(),O.Mb(),O.Nb(35,"ion-text",7),O.mc(36),O.Mb(),O.Mb(),O.lc(37,k,3,4,"ng-container",8),O.Mb(),O.Nb(38,"ion-item-group"),O.Nb(39,"ion-item-divider"),O.Jb(40,"ion-toggle",9,11),O.Nb(42,"ion-label",3),O.Nb(43,"h2"),O.mc(44,"Occupancy"),O.Mb(),O.Jb(45,"ion-progress-bar",12),O.Mb(),O.Nb(46,"ion-text",7),O.mc(47),O.Yb(48,"percent"),O.Mb(),O.Mb(),O.lc(49,Y,3,4,"ng-container",8),O.Mb(),O.Mb(),O.Mb(),O.Mb(),O.Mb()),2&t){var a=O.hc(21),o=O.hc(31),n=O.hc(41);O.yb(13),O.dc("max",e.maxDate)("ngModel",e.date),O.yb(13),O.nc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalSold),O.yb(1),O.dc("ngIf",a.checked),O.yb(9),O.nc(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalPayments),O.yb(1),O.dc("ngIf",o.checked),O.yb(8),O.dc("value",(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth)),O.yb(2),O.oc(" ",O.ac(48,9,(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.totalRoomDays)/(null==e.calculatedData.rooms[0]||null==e.calculatedData.rooms[0].analytics?null:e.calculatedData.rooms[0].analytics.daysInMonth),"2.0-0")," "),O.yb(2),O.dc("ngIf",n.checked)}},directives:[s.q,s.T,s.R,s.g,s.D,s.p,s.J,s.m,s.t,s.z,s.o,s.cb,l.k,l.m,s.n,s.v,s.u,s.S,s.b,s.Q,c.n,s.G,c.m],pipes:[c.p,c.r],styles:[""]}),x)}],C=((P=function t(){n(this,t)}).\u0275mod=O.Gb({type:P}),P.\u0275inj=O.Fb({factory:function(t){return new(t||P)},imports:[[u.k.forChild(J)],u.k]}),P),F=((A=function t(){n(this,t)}).\u0275mod=O.Gb({type:A}),A.\u0275inj=O.Fb({factory:function(t){return new(t||A)},imports:[[c.c,l.h,s.U,C]]}),A)}}])}();